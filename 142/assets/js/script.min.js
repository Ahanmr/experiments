let data={sketch:{background:"#FFFFFF",gravity:9.8},spring:{color:"#000000",strokeWeight:1,rest_length:0.25*window.innerHeight,constant:0.1},bob:{mass:1,radius:100,damping:0.95,stroke:{check:!0,color:"#000000",weight:4},fill:{check:!0,color:"#333333"}}};var controlkit,createControlKit=()=>{controlkit=new ControlKit,controlkit.addPanel({fixed:!1,label:"Controls"}).addColor(data.sketch,"background",{colorMode:"hex",label:"Background Color"}).addSubGroup({label:"Appearance Controls"}).addGroup({label:"Spring Controls"}).addColor(data.spring,"color",{colorMode:"hex",label:"Spring Color"}).addNumberInput(data.spring,"rest_length",{label:"Rest Length",step:1,dp:1}).addNumberInput(data.spring,"strokeWeight",{label:"Stroke Weight",step:1,dp:1}).addNumberInput(data.spring,"constant",{label:"Spring Constant",step:1e-3,dp:4}).addGroup({label:"Bob Controls"}).addCheckbox(data.bob.fill,"check",{label:"Want fill color?"}).addColor(data.bob.fill,"color",{colorMode:"hex",label:"Fill Color"}).addCheckbox(data.bob.stroke,"check",{label:"Want Stroke?"}).addNumberInput(data.bob.stroke,"weight",{label:"Stroke Weight",step:1e-3,dp:3}).addColor(data.bob.stroke,"color",{colorMode:"hex",label:"Stroke Color"}).addNumberInput(data.bob,"radius",{label:"Radius of Bob",step:1,dp:3}).addSubGroup({label:"Behavior Controls"}).addNumberInput(data.sketch,"gravity",{label:"Gravity",step:0.01,dp:3}).addNumberInput(data.bob,"mass",{label:"Mass of Bob",step:0.01,dp:3}).addNumberInput(data.bob,"damping",{label:"Damping on Bob",step:0.01,dp:3})};createControlKit();let system;function setup(){createCanvas(0.75*windowWidth,windowHeight),ellipseMode(CENTER),system=new System(0.5*width,100,300)}function draw(){background(data.sketch.background),system.update(),system.show()}class Bob{constructor(a,b){this.position=new p5.Vector(a,b),this.velocity=new p5.Vector(0,0),this.acceleration=new p5.Vector(0,0),this.dragOffset=new p5.Vector(0,0),this.mass=data.bob.mass,this.damping=data.bob.damping,this.r=data.bob.radius,this.dragging=!1}show(){push(),translate(this.position.x,this.position.y),data.bob.stroke.check?(strokeWeight(data.bob.stroke.weight),stroke(data.bob.stroke.color)):noStroke(),data.bob.fill.check?fill(data.bob.fill.color):noFill(),ellipse(0,0,data.bob.radius,data.bob.radius),pop()}update(){this.velocity.add(this.acceleration),this.velocity.mult(this.damping),this.position.add(this.velocity),this.acceleration.mult(0),this.r=data.bob.radius,this.mass=data.bob.mass,this.damping=data.bob.damping}applyForce(a){this.acceleration.add(a.div(this.mass))}drag(a,b){let c=dist(a,b,this.position.x,this.position.y);c<0.5*this.r&&(this.dragging=!0,this.dragOffset.x=this.position.x-a,this.dragOffset.y=this.position.y-b),this.dragging&&(this.position.x=a+this.dragOffset.x,this.position.y=b+this.dragOffset.y)}}class Spring{constructor(a,b){this.hinge=a,this.bob=b}show(){push(),stroke(data.spring.color),strokeWeight(data.spring.strokeWeight),line(this.hinge.position.x,this.hinge.position.y,this.bob.position.x,this.bob.position.y),pop()}}class Hinge{constructor(a,b){this.position=new p5.Vector(a,b)}show(){push(),strokeWeight(8),stroke(0),point(this.position.x,this.position.y),pop()}}class System{constructor(a,b){this.origin=new p5.Vector(a,b),this.hinge=new Hinge(a,b),this.bob=new Bob(a,data.spring.rest_length),this.spring=new Spring(this.hinge,this.bob)}show(){this.hinge.show(),this.spring.show(),this.bob.show()}update(){let a=p5.Vector.sub(this.bob.position,this.hinge.position).mag(),b=p5.Vector.sub(this.bob.position,this.hinge.position).normalize(),c=data.spring.constant,e=a-data.spring.rest_length,f=b.mult(-(c*e)),g=new p5.Vector(0,data.sketch.gravity*data.bob.mass);this.bob.applyForce(f),this.bob.applyForce(g),this.bob.update(),mouseIsPressed?this.bob.drag(mouseX,mouseY):this.bob.dragging=!1}}