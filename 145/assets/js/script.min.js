let data={sketch:{background:"#000000",scaleX:null,scaleY:null}},video,portrait;function setup(){createCanvas(windowWidth,windowHeight,WEBGL),video=createCapture(VIDEO),video.size(60,40),video.hide(),data.sketch.scaleX=width/video.width,data.sketch.scaleY=height/video.height,noStroke(),rectMode(CENTER),angleMode(DEGREES),ellipseMode(CENTER),portrait=new Video3D(0.5*-width,0.5*-height)}function draw(){frameRate(60),background(data.sketch.background),camera(0,0,300),scale(-1,1),portrait.show()}class Video3D{constructor(a,c){this.position=new p5.Vector(a,c),this.brightnesses=[],this.boxes=[],this.init()}init(){for(var a=0,c=video.width;a<c;a+=1){this.brightnesses[a]=[],this.boxes[a]=[];for(var d=0,e=video.height;d<e;d+=1)this.brightnesses[a][d]=0,this.boxes[a][d]=new Box(a,d)}}show(){push(),translate(this.position.x,this.position.y),orbitControl(),video.loadPixels(),ambientLight(0,0,0),directionalLight(200,200,200,0.05,0.05,0.9),directionalLight(200,200,200,0,0.5,0.3),pointLight(10,10,10,0,0,300),translate(6e-3*width,9e-3*height);for(var a=0,c=video.width;a<c;a+=1)for(var d=0,e=video.height;d<e;d+=1){let f=4*(a+d*video.width),h=video.pixels[f+0],i=video.pixels[f+1],j=video.pixels[f+2],k=(h+i+j)/3;this.brightnesses[a][d]!==NaN&&(3<abs(this.brightnesses[a][d]-k)&&(this.brightnesses[a][d]=k),this.displayBox(a,d))}pop()}displayBox(a,c){specularMaterial(this.brightnesses[a][c]),this.boxes[a][c].update(this.brightnesses[a][c]),this.boxes[a][c].show()}}class Box{constructor(a,c,d=0){this.position=new p5.Vector(a,c,d),this.brightness=0,this.size=127.5>this.brightness?map(this.brightness,0,127.5,-200,0):map(this.brightness,127.5,255,0,100),this.shape=0}update(a){this.brightness=a,this.size=127.5>this.brightness?map(this.brightness,0,127.5,-100,0):map(this.brightness,127.5,255,0,100)}show(){switch(push(),translate(this.position.x*data.sketch.scaleX,this.position.y*data.sketch.scaleY,this.size),this.shape%4){case 1:push(),rotateX(radians(90)),cylinder(0.5*data.sketch.scaleX,100),pop();break;case 2:push(),torus(0.5*data.sketch.scaleX,5),pop();break;case 3:box(0.7*data.sketch.scaleX,0.7*data.sketch.scaleX,100);break;default:sphere(0.7*data.sketch.scaleX);}pop()}}function keyPressed(){portrait.boxes.forEach(a=>{a.forEach(c=>{c.shape++})})}